<% /* views/account/update.ejs */ %>
<h1><%= title %></h1>

<% if (errors) { %>
  <ul class="notice">
    <% errors.array().forEach(error => { %>
      <li><%= error.msg %></li>
    <% }) %>
  </ul>
<% } %>

<!-- Form 1 - Account Update -->
<form method="post" action="/account/update" class="auth-form">
  <label for="account_firstname">First Name</label>
  <input
    type="text"
    id="account_firstname"
    name="account_firstname"
    required
    autocomplete="given-name"
    value="<%= typeof locals.account_firstname !== 'undefined'
              ? locals.account_firstname
              : (account?.account_firstname || accountData?.account_firstname || '') %>" />

  <label for="account_lastname">Last Name</label>
  <input
    type="text"
    id="account_lastname"
    name="account_lastname"
    required
    autocomplete="family-name"
    value="<%= typeof locals.account_lastname !== 'undefined'
              ? locals.account_lastname
              : (account?.account_lastname || accountData?.account_lastname || '') %>" />

  <label for="account_email">Email</label>
  <input
    type="email"
    id="account_email"
    name="account_email"
    required
    autocomplete="email"
    value="<%= typeof locals.account_email !== 'undefined'
              ? locals.account_email
              : (account?.account_email || accountData?.account_email || '') %>" />
  
  <input type="hidden" name="account_id"
         value="<%= account?.account_id || accountData?.account_id %>">

  <button type="submit">Save Changes</button>
</form>

<!-- Form 2 - Change Password -->
<form method="post" action="/account/update-password" class="auth-form">
  <label for="account_password">New Password</label>
  <div class="pw-field">
    <input
      type="password"
      id="account_password"
      name="account_password"
      required
      minlength="12"
      autocomplete="new-password"
      pattern="(?=^.{12,}$)(?=.*\d)(?=.*\W+)(?![.\n])(?=.*[A-Z])(?=.*[a-z]).*$" />
    
    <button type="button"
            class="pw-toggle"
            aria-label="Show Password"
            aria-controls="account_password"
            aria-pressed="false">Show</button>
  </div>

  <p id="form-note" class="form-note">
    Passwords must be at least 12 characters and contain at least
    1 number, 1 capital letter and 1 special character
  </p>
  
  <input type="hidden" name="account_id"
         value="<%= account?.account_id || accountData?.account_id %>">

  <button type="submit">Update Password</button>
</form>

<script src="/js/forms.js" defer></script>
